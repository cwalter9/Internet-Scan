#!/bin/bash

cd /admin/iscan

. functions

runlimit=`cat config | grep AddressScanRun | gawk -F= '{ print $2 }'`
addrdir=`cat config | grep FileAddrDir | gawk -F= '{ print $2 }'`

for i in `echo "select addid from address where status=1 limit $runlimit" | $MYSQLQ`; do
  address=`echo "select ipaddr from address where addid='$i'" | $MYSQLQ`

  nmap --host-timeout 30 -sn "$address" -oG address/$address
  echo "update address set status=2 where addid='$i'" | $MYSQLQ

done

funstop $processname
