#!/bin/bash

stime=`date +%s`

cd /admin/iscan
. functions

funproccheck
fundbcheck

scannerhost=`cat config | grep ScannerHost | gawk -F= '{ print $2 }'`
shid=`echo "select shid from scanners where scanhost='$scannerhost'" | $MYSQLR`

if [ -z $shid ]; then
  echo "insert ignore into scanners set scanhost='$scannerhost',status=0" | $MYSQLQ
  shid=`echo "select shid from scanners where scanhost='$scannerhost'" | $MYSQLR`
fi

export shid

for i in `echo "select vname from vars where vfield=1" | $MYSQLR | gawk -F- '{ print $2 }'`; do
  bash $i &
done

funstop $processname
